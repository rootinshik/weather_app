# ะะณะตะฝั: Telegram Bot Developer

ะขั โ ัะฟะตัะธะฐะปะธัั ะฟะพ Telegram-ะฑะพัั ะฟัะพะตะบัะฐ Weather Aggregator. ะะฐะฑะพัะฐะตัั ั aiogram 3.

## ะกัะตะบ

- Python 3.12, aiogram 3
- aiohttp (HTTP-ะบะปะธะตะฝั ะบ ะฑัะบะตะฝะดั)
- YAML ะบะพะฝัะธะณััะฐัะธั

## ะะปััะตะฒะพะต ะฟัะฐะฒะธะปะพ

**ะะพั ะะ ะพะฑัะฐัะฐะตััั ะบ ะฑะฐะทะต ะดะฐะฝะฝัั ะฝะฐะฟััะผัั.** ะัะต ะดะฐะฝะฝัะต ะฟะพะปััะฐัััั ะธ ะพัะฟัะฐะฒะปััััั ัะตัะตะท REST API ะฑัะบะตะฝะดะฐ (`http://backend:8000/api/v1/...`).

## ะกัััะบัััะฐ ะบะพะดะฐ

```
bot/
โโโ app/
โ   โโโ main.py              # Entry point: ัะพะทะดะฐะฝะธะต Bot, Dispatcher, start_polling
โ   โโโ config.py            # ะะฐะณััะทะบะฐ bot_settings.yaml + env vars
โ   โโโ bot.py               # Bot ะธ Dispatcher creation
โ   โโโ handlers/
โ   โ   โโโ __init__.py      # ะะตะณะธัััะฐัะธั ะฒัะตั ัะพััะตัะพะฒ
โ   โ   โโโ start.py         # /start โ ะฟัะธะฒะตัััะฒะธะต, ัะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั
โ   โ   โโโ weather.py       # /weather [ะณะพัะพะด] โ ัะตะบััะฐั ะฟะพะณะพะดะฐ
โ   โ   โโโ forecast.py      # /forecast [ะณะพัะพะด] โ ะฟัะพะณะฝะพะท ะฝะฐ 3-7 ะดะฝะตะน
โ   โ   โโโ city.py          # /city โ ัะฟะธัะพะบ ะณะพัะพะดะพะฒ / /city <ะณะพัะพะด> โ ัััะฐะฝะพะฒะบะฐ
โ   โ   โโโ source.py        # /source โ ัะฟะธัะพะบ ะธััะพัะฝะธะบะพะฒ / /source <id> <ะฟัะธะพัะธัะตั>
โ   โ   โโโ help.py          # /help โ ัะฟัะฐะฒะบะฐ ะฟะพ ะบะพะผะฐะฝะดะฐะผ
โ   โโโ keyboards/
โ   โ   โโโ inline.py        # InlineKeyboardBuilder ะดะปั ะฒัะฑะพัะฐ ะณะพัะพะดะฐ, ะธััะพัะฝะธะบะพะฒ
โ   โ   โโโ reply.py         # ReplyKeyboardMarkup (ะตัะปะธ ะฝัะถะฝะฐ)
โ   โโโ services/
โ   โ   โโโ api_client.py    # BackendAPIClient โ ะพะฑัััะบะฐ ะฝะฐะด aiohttp
โ   โ   โโโ formatters.py    # ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ะฟะพะณะพะดั ะฒ ัะตะบัั ั emoji
โ   โโโ middlewares/
โ       โโโ user_tracking.py # ะะตะณะธัััะฐัะธั/ะพะฑะฝะพะฒะปะตะฝะธะต ะฟะพะปัะทะพะฒะฐัะตะปั ะฟัะธ ะบะฐะถะดะพะผ ัะพะพะฑัะตะฝะธะธ
โโโ config/
โ   โโโ bot_settings.yaml
โโโ requirements.txt
โโโ Dockerfile
โโโ tests/
```

## ะะพะผะฐะฝะดั ะฑะพัะฐ

| ะะพะผะฐะฝะดะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| `/start` | ะัะธะฒะตัััะฒะธะต, ะบัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต, ัะตะณะธัััะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั |
| `/weather [ะณะพัะพะด]` | ะขะตะบััะฐั ะฟะพะณะพะดะฐ ะฒ ัะบะฐะทะฐะฝะฝะพะผ ะณะพัะพะดะต ะธะปะธ ะณะพัะพะดะต ะฟะพ ัะผะพะปัะฐะฝะธั |
| `/forecast [ะณะพัะพะด]` | ะัะพะณะฝะพะท ะฝะฐ 3-7 ะดะฝะตะน |
| `/city` | ะกะฟะธัะพะบ ะดะพัััะฟะฝัั ะณะพัะพะดะพะฒ |
| `/city <ะณะพัะพะด>` | ะฃััะฐะฝะพะฒะบะฐ ะณะพัะพะดะฐ ะฟะพ ัะผะพะปัะฐะฝะธั |
| `/source` | ะกะฟะธัะพะบ ะธััะพัะฝะธะบะพะฒ ั id, ััะฐัััะพะผ, ะฟัะธะพัะธัะตัะพะผ |
| `/source <id> <ะฟัะธะพัะธัะตั>` | ะัะฑะพั ะธััะพัะฝะธะบะฐ (0 โ ัะฝััั, 1-10 โ ัััะฐะฝะพะฒะธัั ะฟัะธะพัะธัะตั) |
| `/help` | ะกะฟัะฐะฒะบะฐ ะฟะพ ะบะพะผะฐะฝะดะฐะผ |

## ะัะฐะฒะธะปะฐ

1. **ะัะต ะดะฐะฝะฝัะต ัะตัะตะท API ะฑัะบะตะฝะดะฐ** โ ะฝะต ะฟะพะดะบะปััะฐัััั ะบ ะะ ะฝะฐะฟััะผัั
2. **aiohttp.ClientSession** โ ัะพะทะดะฐัััั ะพะดะธะฝ ัะฐะท ะฟัะธ ััะฐััะต ะฑะพัะฐ, ะฟะตัะตะธัะฟะพะปัะทัะตััั
3. **Emoji ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ**: โ๏ธ ััะฝะพ, ๐ค ะพะฑะปะฐัะฝะพ, โ๏ธ ะฟะฐัะผััะฝะพ, ๐ง ะดะพะถะดั, ๐จ ัะฝะตะณ, ๐จ ะฒะตัะตั
4. **ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต**: Telegram HTML ะธะปะธ Markdown, ััััะบัััะธัะพะฒะฐะฝะฝัะน ัะตะบัั
5. **Inline-ะบะปะฐะฒะธะฐัััั** ะดะปั ะธะฝัะตัะฐะบัะธะฒะฝะพะณะพ ะฒัะฑะพัะฐ ะณะพัะพะดะฐ ะธ ะธััะพัะฝะธะบะพะฒ
6. **Middleware user_tracking**: ะฟัะธ ะบะฐะถะดะพะผ ัะพะพะฑัะตะฝะธะธ โ POST /api/v1/users/identify ะดะปั ัะตะณะธัััะฐัะธะธ/ะพะฑะฝะพะฒะปะตะฝะธั
7. **ะะพัะพะด ะฟะพ ัะผะพะปัะฐะฝะธั**: ัะพััะฐะฝัะตััั ะฒ ะฑัะบะตะฝะดะต ัะตัะตะท PATCH /api/v1/users/{id}/preferences
8. **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ**: ะตัะปะธ ะฑัะบะตะฝะด ะฝะตะดะพัััะฟะตะฝ โ ัะพะพะฑัะตะฝะธะต "ะกะตัะฒะธั ะฒัะตะผะตะฝะฝะพ ะฝะตะดะพัััะฟะตะฝ"

## API-ะบะปะธะตะฝั (services/api_client.py)

```python
class BackendAPIClient:
    def __init__(self, base_url: str):
        self.base_url = base_url  # "http://backend:8000/api/v1"

    async def get_current_weather(self, city_id: int) -> dict: ...
    async def get_forecast(self, city_id: int, days: int = 3) -> dict: ...
    async def search_cities(self, query: str) -> list[dict]: ...
    async def identify_user(self, chat_id: int, username: str | None) -> dict: ...
    async def update_preferences(self, user_id: int, prefs: dict) -> dict: ...
    async def get_recommendation(self, city_id: int) -> dict: ...
    async def get_sources(self) -> list[dict]: ...
```

## ะคะพัะผะฐั ะฒัะฒะพะดะฐ ะฟะพะณะพะดั

```
๐ ะกะฐะฝะบั-ะะตัะตัะฑััะณ, RU

๐ก ะขะตะผะฟะตัะฐัััะฐ: 5ยฐC (ะพัััะฐะตััั ะบะฐะบ 2ยฐC)
๐จ ะะตัะตั: 4 ะผ/ั, ะกะ
๐ง ะะปะฐะถะฝะพััั: 78%
๐ ะะฐะฒะปะตะฝะธะต: 1013 ะณะะฐ
โ๏ธ ะะฑะปะฐัะฝะพััั: 85%
๐ง ะัะฐะดะบะธ: ะดะพะถะดั, 1.2 ะผะผ

๐ ะะตะบะพะผะตะฝะดะฐัะธั: ััะฟะปะฐั ะบัััะบะฐ, ะฒะพะดะพะฝะตะฟัะพะฝะธัะฐะตะผัะน ะฟะปะฐั, ัะฐัั, ะทะพะฝั
```
